// ============================================
// ANIMATIONS & TRANSITIONS
// Material Design 3 Expressive Motion
// ============================================

$spring-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);  //overshoot bounce
$spring-gentle: cubic-bezier(0.22, 1, 0.36, 1); //gentle spring settle
$spring-snappy: cubic-bezier(0.2, 0.9, 0.3, 1.1); //quick with slight overshoot
$spring-elastic: cubic-bezier(0.68, -0.55, 0.27, 1.55); //elastic feel
$md3-emphasized: cubic-bezier(0.05, 0.7, 0.1, 1.0); //MD3 standard emphasized
$md3-emphasized-decel: cubic-bezier(0.05, 0.7, 0.1, 1.0); //decelerate
$md3-emphasized-accel: cubic-bezier(0.3, 0, 0.8, 0.15); //accelerate

// ============================================
// BASE KEYFRAMES
// ============================================

@keyframes iosMessageEnter {
  0% { opacity: 0; transform: translateY(20px) scale(0.9); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

@keyframes slideDown {
  from { transform: translateY(0); }
  to { transform: translateY(100%); }
}

@keyframes modalScaleIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes sheetSlideIn {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

@keyframes popIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes pulseSoft {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes typingBounce {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-4px); }
}

@keyframes slideInFromBottom {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes subtlePulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(0.98); }
}

@keyframes floatIn {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInLeft {
  from { opacity: 0; transform: translateX(-12px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes slideInRight {
  from { opacity: 0; transform: translateX(12px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@keyframes gentleBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-2px); }
}

@keyframes expandIn {
  0% { opacity: 0; max-height: 0; transform: scaleY(0.8); transform-origin: bottom; }
  40% { opacity: 1; max-height: 120px; transform: scaleY(1.02); }
  70% { transform: scaleY(0.98); }
  100% { max-height: 120px; transform: scaleY(1); }
}

@keyframes expandOut {
  0% { opacity: 1; max-height: 120px; transform: scaleY(1); }
  100% { opacity: 0; max-height: 0; transform: scaleY(0.8); transform-origin: bottom; }
}

// ============================================
// MD3 EXPRESSIVE KEYFRAMES
// ============================================

@keyframes md3MessageEnter {
  0% { opacity: 0; transform: translateY(32px) scale(0.96); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes md3GroupNudge {
  0% { transform: translateY(0); }
  30% { transform: translateY(-3px); }
  60% { transform: translateY(1px); }
  100% { transform: translateY(0); }
}

@keyframes md3ReactionPop {
  0% { transform: scale(0); opacity: 0; }
  50% { transform: scale(1.3); opacity: 1; }
  70% { transform: scale(0.9); }
  85% { transform: scale(1.05); }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes md3ReactionRemove {
  0% { transform: scale(1); opacity: 1; }
  30% { transform: scale(1.1); opacity: 0.8; }
  100% { transform: scale(0); opacity: 0; }
}

@keyframes md3LongPressLift {
  0% { transform: scale(1); box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
  100% { transform: scale(1.02); box-shadow: 0 8px 24px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.1); }
}

@keyframes md3SendBtnActivate {
  0% { transform: scale(1) rotate(0deg); }
  30% { transform: scale(0.85) rotate(-15deg); }
  60% { transform: scale(1.1) rotate(5deg); }
  80% { transform: scale(0.98) rotate(-2deg); }
  100% { transform: scale(1) rotate(0deg); }
}

@keyframes md3SendPulse {
  0% { transform: scale(1); }
  50% { transform: scale(0.92); }
  100% { transform: scale(1); }
}

@keyframes md3ErrorShake {
  0%, 100% { transform: translateX(0); }
  10% { transform: translateX(-8px); }
  20% { transform: translateX(7px); }
  30% { transform: translateX(-6px); }
  40% { transform: translateX(5px); }
  50% { transform: translateX(-3px); }
  60% { transform: translateX(2px); }
  70% { transform: translateX(-1px); }
}

@keyframes md3ScrollBtnEnter {
  0% { opacity: 0; transform: translateX(-50%) scale(0.5) translateY(20px); }
  60% { opacity: 1; transform: translateX(-50%) scale(1.08) translateY(-4px); }
  80% { transform: translateX(-50%) scale(0.96) translateY(2px); }
  100% { transform: translateX(-50%) scale(1) translateY(0); }
}

@keyframes md3ScrollBtnExit {
  0% { opacity: 1; transform: translateX(-50%) scale(1); }
  100% { opacity: 0; transform: translateX(-50%) scale(0.6) translateY(10px); }
}

@keyframes md3MediaExpand {
  0% { opacity: 0; transform: scale(0.7); filter: brightness(1.1); }
  50% { transform: scale(1.03); }
  70% { transform: scale(0.99); }
  100% { opacity: 1; transform: scale(1); filter: brightness(1); }
}

@keyframes md3MediaCollapse {
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.8); }
}

@keyframes md3ContainerTransform {
  0% { clip-path: circle(24px at center); transform: scale(0.5); }
  60% { clip-path: circle(100% at center); transform: scale(1.02); }
  100% { clip-path: circle(100% at center); transform: scale(1); }
}

@keyframes md3ToastEnter {
  0% { opacity: 0; transform: translateY(24px) scale(0.9); }
  60% { transform: translateY(-4px) scale(1.02); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes md3ToastExit {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  100% { opacity: 0; transform: translateY(16px) scale(0.95); }
}

@keyframes md3StickerPop {
  0% { opacity: 0; transform: scale(0.3) rotate(-10deg); }
  50% { transform: scale(1.15) rotate(3deg); }
  70% { transform: scale(0.95) rotate(-1deg); }
  85% { transform: scale(1.02) rotate(0.5deg); }
  100% { opacity: 1; transform: scale(1) rotate(0deg); }
}

@keyframes md3Ripple {
  0% { transform: scale(0); opacity: 0.4; }
  100% { transform: scale(2.5); opacity: 0; }
}

@keyframes lightboxEnter {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

@keyframes lightboxImageEnter {
  0% { opacity: 0; transform: scale(0.85); }
  60% { transform: scale(1.02); }
  100% { opacity: 1; transform: scale(1); }
}

// ============================================
// VUE TRANSITION CLASSES
// ============================================

.message-enter-active { animation: var(--animation-message-enter); z-index: 1; }
.message-leave-active { animation: fadeOut 0.3s ease-out; position: absolute; width: 100%; z-index: 0; }
.message-move { transition: var(--animation-message-move); }

.slide-up-enter-active { animation: slideUp 0.3s $spring-bounce; }
.slide-up-leave-active { animation: slideDown 0.25s $spring-gentle; }

.fade-enter-active { animation: fadeIn 0.2s ease-out; }
.fade-leave-active { animation: fadeOut 0.15s ease-out; }

.modal-backdrop-enter-active { animation: fadeIn 0.2s ease-out; }
.modal-backdrop-leave-active { animation: fadeOut 0.2s ease-out; }
.modal-content-enter-active { animation: modalScaleIn 0.25s $spring-bounce; }
.modal-content-leave-active { animation: fadeOut 0.2s ease-out; }

.sheet-enter-active { animation: sheetSlideIn 0.35s $spring-bounce; }
.sheet-leave-active { animation: slideDown 0.25s $spring-gentle; }

.file-enter-active { animation: slideInFromBottom 0.2s $spring-bounce; }
.file-leave-active { animation: fadeOut 0.15s ease-out; }

.expand-enter-active { animation: expandIn 0.4s $spring-bounce; overflow: hidden; }
.expand-leave-active { animation: expandOut 0.25s ease-out; overflow: hidden; }

.stagger-item {
  animation: floatIn 0.3s ease-out backwards;
  @for $i from 1 through 10 {
    &:nth-child(#{$i}) { animation-delay: #{$i * 0.03}s; }
  }
}

.scroll-btn-enter-active { animation: md3ScrollBtnEnter 0.5s $spring-bounce; }
.scroll-btn-leave-active { animation: md3ScrollBtnExit 0.3s $spring-gentle; }

.toast-enter-active { animation: md3ToastEnter 0.4s $spring-bounce; }
.toast-leave-active { animation: md3ToastExit 0.25s ease-out; }

.lightbox-enter-active {
  animation: lightboxEnter 0.25s ease-out;
  .lightbox-image { animation: lightboxImageEnter 0.4s $spring-bounce; }
}
.lightbox-leave-active { animation: fadeOut 0.2s ease-out; }

.slide-next-enter-active, .slide-next-leave-active,
.slide-prev-enter-active, .slide-prev-leave-active {
  transition: all 0.25s ease-out;
  will-change: transform, opacity;
}

.slide-next-enter-from { opacity: 0; transform: translateX(20px); }
.slide-next-leave-to { opacity: 0; transform: translateX(-20px); }

.slide-prev-enter-from { opacity: 0; transform: translateX(-20px); }
.slide-prev-leave-to { opacity: 0; transform: translateX(20px); }

// ============================================
// MD3 THEME SPECIFIC ANIMATIONS
// ============================================

[data-theme="material"] {
  --animation-message-enter: md3MessageEnter 0.55s #{$md3-emphasized};
  --animation-message-move: transform 0.4s #{$md3-emphasized};
  
  .reaction-btn {
    &.just-added { animation: md3ReactionPop 0.45s $spring-bounce; }
    &.removing { animation: md3ReactionRemove 0.3s ease-out forwards; }
  }
  
  .bubble.long-pressed { animation: md3LongPressLift 0.2s $spring-gentle forwards; }
  
  .send-btn {
    .send-btn-icon { transition: transform 0.3s $spring-bounce; }
    &:not(:disabled):active .send-btn-icon { animation: md3SendPulse 0.15s ease-out; }
    &.send-btn--sending .send-btn-icon { animation: md3SendBtnActivate 0.5s $spring-bounce; }
    &.send-btn--error { animation: md3ErrorShake 0.6s ease-out; }
  }
  
  .sticker-message { animation: md3StickerPop 0.5s $spring-bounce; }
  .message-row.adjacent-nudge { animation: md3GroupNudge 0.35s $spring-gentle; }

  .lightbox-image {
    animation: none;
  }

  .lightbox-enter-active .lightbox-image {
    animation: md3MediaExpand 0.45s $spring-bounce;
  }
}

.spring-bounce { transition-timing-function: $spring-bounce; }
.spring-gentle { transition-timing-function: $spring-gentle; }
.spring-snappy { transition-timing-function: $spring-snappy; }
.spring-elastic { transition-timing-function: $spring-elastic; }

.ripple-container {
  position: relative;
  overflow: hidden;
  &::after {
    content: ''; position: absolute; top: 50%; left: 50%; width: 100%; padding-bottom: 100%;
    border-radius: 50%; background: currentColor; opacity: 0;
    transform: translate(-50%, -50%) scale(0); pointer-events: none;
  }
  &:active::after { animation: md3Ripple 0.6s ease-out; }
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}